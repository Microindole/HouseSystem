{% extends 'base.html' %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/house/house_list.css') }}">
<script src="{{ url_for('static', filename='js/common/message-toast.js') }}"></script>
<script src="{{ url_for('static', filename='js/house/show-news.js') }}"></script>
<style>
.container {
    max-width: 1200px;
    margin: 20px auto;
    background: #f8f9fa;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    padding: 24px;
}

/* æ–°é—»åŒºæ ·å¼ä¼˜åŒ– */
.news-section {
    margin-bottom: 24px;
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    padding: 20px;
}
.news-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}
.news-header h2 {
    color: #1976d2;
    font-size: 1.5rem;
    font-weight: bold;
}
.news-controls button {
    background: #1976d2;
    color: #fff;
    border: none;
    border-radius: 4px;
    padding: 6px 12px;
    cursor: pointer;
    font-size: 0.9rem;
}
.news-controls button:disabled {
    background: #ccc;
}
.news-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
    gap: 16px;
}
.news-item {
    background: #ffffff;
    border-radius: 8px;
    box-shadow: 0 1px 6px rgba(0, 0, 0, 0.05);
    padding: 16px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}
.news-title {
    font-size: 1.2rem;
    font-weight: bold;
    color: #333;
    margin-bottom: 8px;
}
.news-desc {
    font-size: 1rem;
    color: #555;
    margin-bottom: 12px;
}
.news-footer {
    font-size: 0.9rem;
    color: #777;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

/* æˆ¿æºåˆ—è¡¨æ ·å¼ä¼˜åŒ– */
.house-list-section {
    margin-top: 24px;
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    padding: 20px;
}
.house-list-section h2 {
    color: #1976d2;
    font-size: 1.5rem;
    font-weight: bold;
    margin-bottom: 16px;
}
.house-cards-horizontal {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
    gap: 20px;
}
.house-card-horizontal {
    background: #ffffff;
    border-radius: 8px;
    box-shadow: 0 1px 6px rgba(0, 0, 0, 0.05);
    padding: 16px;
    display: flex;
    gap: 12px;
}
.house-image-horizontal {
    width: 120px;
    height: 90px;
    object-fit: cover;
    border-radius: 8px;
    background: #eaeaea;
}
.house-info-horizontal {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 8px;
}
.house-title-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.house-title-horizontal {
    font-size: 1.2rem;
    font-weight: bold;
    color: #333;
}
.house-price-horizontal {
    color: #ff5722;
    font-weight: bold;
    font-size: 1.1rem;
}
.house-detail-row {
    font-size: 1rem;
    color: #555;
    display: flex;
    gap: 8px;
}
.btn-detail-horizontal {
    margin-top: 12px;
    background: #1976d2;
    color: #fff;
    border-radius: 6px;
    padding: 8px 16px;
    font-size: 1rem;
    text-decoration: none;
    text-align: center;
    transition: background 0.2s;
}
.btn-detail-horizontal:hover {
    background: #1256a3;
}

/* å“åº”å¼ä¼˜åŒ– */
@media (max-width: 768px) {
    .container {
        padding: 16px;
    }
    .news-container {
        grid-template-columns: 1fr;
    }
    .house-cards-horizontal {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}



{% block title %}æˆ¿æºåˆ—è¡¨{% endblock %}

{% block body %}
<div class="container">
{% if filters.city %}
<p>å½“å‰é€‰æ‹©åœ°åŒºï¼š<strong>{{ filters.city}}</strong></p>
{% endif %}

   <!-- æ–°é—»åŒº -->
    <div class="news-section">
        <div class="news-header">
            <h2>æœ€æ–°èµ„è®¯</h2>
            <div class="news-controls">
                <button id="prev-news" class="nav-btn" disabled>â€¹</button>
                <button id="next-news" class="nav-btn">â€º</button>
            </div>
        </div>

        {% if news_list %}
        <div class="news-container">
            <div class="news-carousel" id="news-carousel">
                {% for news in news_list %}
                <div class="news-item" data-index="{{ loop.index0 }}">
                    <div class="news-content">
                        <h3 class="news-title">{{ news.title }}</h3>
                        <p class="news-desc">{{ news.desc[:100] if news.desc else 'æš‚æ— è¯¦ç»†æè¿°' }}{% if news.desc and news.desc|length > 100 %}...{% endif %}</p>
                        <div class="news-footer">
                            <span class="news-date">{{ news.time.strftime('%mæœˆ%dæ—¥') if news.time else 'æœªçŸ¥æ—¶é—´' }}</span>
                            {% if news.house_info %}
                            <span class="news-house">{{ news.house_info.house_name }}</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="news-indicators">
            {% for i in range((news_list|length + 2) // 3) %}
            <span class="indicator {% if loop.index0 == 0 %}active{% endif %}" data-slide="{{ loop.index0 }}"></span>
            {% endfor %}
        </div>

        <div class="news-footer-section">
            <button id="load-more-news" class="btn btn-primary">æŸ¥çœ‹æ›´å¤šæ–°é—»</button>
            <span class="news-stats">å…± <span id="total-news">{{ news_list|length }}</span> æ¡èµ„è®¯</span>
        </div>
        {% else %}
        <div class="no-news">
            <div class="no-news-icon">ğŸ“°</div>
            <p>æš‚æ— æ–°é—»èµ„è®¯</p>
        </div>
        {% endif %}
    </div>

<!-- house_list.html ä¸­çš„ç­›é€‰è¡¨å• -->
<form method="get" action="{{ url_for('house.house_list') }}" class="filter-form">

  <!-- çœå¸‚è”åŠ¨ï¼ˆåªè¯»å±•ç¤ºï¼Œå®é™…ä»å¯¼èˆªæ å·²åˆ‡æ¢ï¼‰ -->
  <input type="hidden" name="region" value="{{ selected_region }}">
  <input type="hidden" name="city" value="{{ selected_city }}">

<label>åœ°å€å…³é”®è¯ï¼š</label>
<input type="text" name="address" placeholder="ä¾‹å¦‚ï¼šæœé˜³ã€äº”é“å£" value="{{ filters.address or '' }}">
  <label>æˆ·å‹ï¼š</label>
  <select name="rooms">
    <option value="">ä¸é™</option>
    <option value="1å®¤" {% if filters.rooms == '1å®¤' %}selected{% endif %}>1å®¤</option>
    <option value="2å®¤" {% if filters.rooms == '2å®¤' %}selected{% endif %}>2å®¤</option>
    <option value="3å®¤" {% if filters.rooms == '3å®¤' %}selected{% endif %}>3å®¤</option>
    <option value="4å®¤" {% if filters.rooms == '4å®¤' %}selected{% endif %}>4å®¤</option>
    <option value="4å®¤åŠä»¥ä¸Š" {% if filters.rooms == '4å®¤åŠä»¥ä¸Š' %}selected{% endif %}>4å®¤åŠä»¥ä¸Š</option>
  </select>

  <label>ä»·æ ¼èŒƒå›´ï¼š</label>
  <input type="number" name="min_price" placeholder="æœ€ä½ä»·" value="{{ filters.min_price }}">
  -
  <input type="number" name="max_price" placeholder="æœ€é«˜ä»·" value="{{ filters.max_price }}">

  <button type="submit">ç­›é€‰</button>
</form>
    <!-- æˆ¿æºåˆ—è¡¨ -->
    <div class="house-list-section">
        <h2>æˆ¿æºåˆ—è¡¨</h2>
        <div class="house-cards-horizontal">
            {% if houses %}
                {% for house in houses %}
                <div class="house-card-horizontal">
                    {% if house.image %}
                        <img src="{{ house.image }}" class="house-image-horizontal" alt="æˆ¿å±‹å›¾ç‰‡">
                    {% else %}
                        <img src="{{ url_for('static', filename='images/default_house_thumbnail.png') }}" class="house-image-horizontal" alt="æš‚æ— å›¾ç‰‡">
                    {% endif %}
                    <div class="house-info-horizontal">
                        <div class="house-title-row">
                            <span class="house-title-horizontal">{{ house.house_name }}</span>
                            <span class="house-price-horizontal">{{ house.price }} å…ƒ/æœˆ</span>
                        </div>
                        <div class="house-detail-row">
                            <span>æˆ·å‹ï¼š{{ house.rooms }}</span>
                            <span>åœ°åŒºï¼š{{ house.region }}</span>
                        </div>
                        <div class="house-detail-row">
                            <span>åœ°å€ï¼š{{ house.addr }}</span>
                        </div>
                        {% if house.highlight %}
                        <div class="house-highlight">äº®ç‚¹ï¼š{{ house.highlight }}</div>
                        {% endif %}
                        {% if house.situation %}
                        <div class="house-situation">è£…ä¿®ï¼š{{ house.situation }}</div>
                        {% endif %}
                        {% if house.deposit %}
                        <div class="house-deposit">æŠ¼é‡‘ï¼š{{ house.deposit }} å…ƒ</div>
                        {% endif %}
                        <a href="{{ url_for('house.house_detail', house_id=house.house_id) }}" class="btn-detail-horizontal">æŸ¥çœ‹è¯¦æƒ…</a>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <p class="no-houses-message">æš‚æ— ç¬¦åˆæ¡ä»¶çš„æˆ¿æºã€‚</p>
            {% endif %}
        </div>
    </div>
<!-- åˆ†é¡µæ§åˆ¶ -->
<div class="pagination">
    {% if pagination.pages > 1 %}
        <ul class="pagination-list">
            {% if pagination.has_prev %}
                <li><a href="{{ url_for('house.house_list', page=1, **filters) }}">é¦–é¡µ</a></li>
                <li><a href="{{ url_for('house.house_list', page=pagination.prev_num, **filters) }}">ä¸Šä¸€é¡µ</a></li>
            {% endif %}
            {% for p in range(1, pagination.pages + 1) %}
                {% if p == pagination.page %}
                    <li class="active"><span>{{ p }}</span></li>
                {% else %}
                    <li><a href="{{ url_for('house.house_list', page=p, **filters) }}">{{ p }}</a></li>
                {% endif %}
            {% endfor %}
            {% if pagination.has_next %}
                <li><a href="{{ url_for('house.house_list', page=pagination.next_num, **filters) }}">ä¸‹ä¸€é¡µ</a></li>
                <li><a href="{{ url_for('house.house_list', page=pagination.pages, **filters) }}">æœ«é¡µ</a></li>
            {% endif %}
        </ul>
    {% endif %}
</div>

</div>
{% endblock %}

